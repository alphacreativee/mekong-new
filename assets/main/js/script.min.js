import{preloadImages}from"../../libs/utils.js";$=jQuery;let lenis=new Lenis;lenis.on("scroll",ScrollTrigger.update),gsap.ticker.add(t=>{lenis.raf(1e3*t)}),gsap.ticker.lagSmoothing(0);var swiperInstance=null;function initSwiper(){var n,t,e=document.getElementById("panelBox"),a=e.querySelectorAll(".dbcontent");window.innerWidth<=991?swiperInstance||((n=document.createElement("div")).className="swiper-wrapper",a.forEach(function(t){var e=document.createElement("div");e.className="swiper-slide",e.appendChild(t.cloneNode(!0)),n.appendChild(e)}),e.innerHTML="",e.className="panelBox swiper",e.appendChild(n),(t=document.createElement("div")).className="swiper-pagination",e.appendChild(t),swiperInstance=new Swiper(".swiper",{slidesPerView:1,spaceBetween:20,pagination:!1,on:{slideChange:function(){window.activateDonutArc&&window.activateDonutArc(this.activeIndex)}}})):swiperInstance&&(swiperInstance.destroy(!0,!0),swiperInstance=null,e.className="panelBox",e.innerHTML="",a.forEach(function(t){e.appendChild(t)}))}function donut(){var i=[],c=(document.querySelectorAll(".dbcontent").forEach(function(t,e){var n=t.className.match(/dbcontent--(\d+)/)[1],a=t.querySelector(".panel-title"),a=a?a.textContent.trim():"Label "+(e+1),e=parseInt(t.getAttribute("data-value"))||10;i.push({label:a,value:e,link:"#",content:n})}),Math.min(330,330)/2),a=0,t=d3.svg.arc().innerRadius(c-60).outerRadius(c-10),e=d3.layout.pie().value(function(t){return t.value}).sort(null),n=d3.select("#donut-chart").attr("width",330).attr("height",330).append("g").attr("transform","translate("+c+","+c+")"),l=n.selectAll(".arc").data(e(i)).enter().append("g").attr("class",function(t,e){return 0===e?"arc active":"arc"}).each(function(t,e){t.index=e}).on("click",function(t,e){a=t.index,r(t.index)}).on("mouseover",function(t){d3.select(this).classed("active")||(d3.select(this).select("path").attr("fill","#b71c1c"),d3.select(this).select("textPath").attr("fill","#fff"))}).on("mouseout",function(t){d3.select(this).classed("active")||(d3.select(this).select("path").attr("fill","#fff"),d3.select(this).select("textPath").attr("fill","#000"))});function r(e){var t,n=i[a=e].content;window.innerWidth<=991&&swiperInstance?(swiperInstance.slideTo(e),(t=document.querySelectorAll(".swiper-slide .dbcontent")).forEach(function(t){t.classList.remove("active")}),t[e]&&t[e].classList.add("active")):(d3.selectAll(".dbcontent").classed("active",!1),d3.select(".dbcontent--"+n).classed("active",!0)),l.classed("active",!1),l.each(function(t){t.index===e&&d3.select(this).classed("active",!0)}),s()}function s(){l.selectAll("path").attr("fill",function(){return d3.select(this.parentNode).classed("active")?"#b71c1c":"#fff"}),l.selectAll("textPath").attr("fill",function(){return d3.select(this.parentNode.parentNode).classed("active")?"#fff":"#000"})}s(),l.append("path").attr("d",t).attr("fill",function(t,e){return 0===e?"#b71c1c":"#fff"}),l.each(function(t,e){var n=d3.select(this),a=(c-80+c-5)/2,a=d3.svg.arc().innerRadius(a).outerRadius(a).startAngle(t.startAngle).endAngle(t.endAngle);n.append("path").attr("id","textPath-"+e).attr("d",a).style("fill","none").style("stroke","none"),n.append("text").style("pointer-events","none").append("textPath").attr("xlink:href","#textPath-"+e).style("text-anchor","middle").attr("startOffset","25%").attr("dy","-0.5em").attr("fill",function(){return d3.select(this.parentNode.parentNode).classed("active")?"#fff":"#000"}).attr("font-size","12px").attr("font-weight","700").attr("letter-spacing","0.5px").style("text-transform","uppercase").text(i[e].label)}),n.append("circle").attr("cx",0).attr("cy",0).attr("r",90).attr("fill","#b71c1c"),n.append("text").attr("dy","0.35em").style("text-anchor","middle").attr("class","inner-circle-text").attr("fill","#fff").attr("font-size","40px").attr("font-weight","bold").attr("letter-spacing","2px").text("VISION"),document.getElementById("prevBtn").addEventListener("click",function(){r(a=(a-1+i.length)%i.length)}),document.getElementById("nextBtn").addEventListener("click",function(){r(a=(a+1)%i.length)}),window.activateDonutArc=r}let init=()=>{gsap.registerPlugin(ScrollTrigger),donut(),initSwiper()},isLinkClicked=(preloadImages("img").then(()=>{init()}),!1);$("a").on("click",function(t){!this.href||this.href.match(/^#/)||this.href.match(/^javascript:/)||(isLinkClicked=!0,console.log("1"))}),$(window).on("beforeunload",function(){isLinkClicked||$(window).scrollTop(0),isLinkClicked=!1});