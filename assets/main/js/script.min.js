import{preloadImages}from"../../libs/utils.js";$=jQuery;let lenis=new Lenis;function donut(){var l=[],i=(document.querySelectorAll(".dbcontent").forEach(function(t,e){var n=t.className.match(/dbcontent--(\d+)/)[1],a=t.querySelector(".panel-title"),a=a?a.textContent.trim():"Label "+(e+1),e=parseInt(t.getAttribute("data-value"))||10;l.push({label:a,value:e,link:"#",content:n})}),Math.min(330,330)/2),n=0,t=d3.svg.arc().innerRadius(i-60).outerRadius(i-10),e=d3.layout.pie().value(function(t){return t.value}).sort(null),a=d3.select("#donut-chart").attr("width",330).attr("height",330).append("g").attr("transform","translate("+i+","+i+")"),c=a.selectAll(".arc").data(e(l)).enter().append("g").attr("class",function(t,e){return 0===e?"arc active":"arc"}).each(function(t,e){t.index=e}).on("click",function(t,e){n=t.index,r(t.index)}).on("mouseover",function(t){d3.select(this).classed("active")||(d3.select(this).select("path").attr("fill","#b71c1c"),d3.select(this).select("textPath").attr("fill","#fff"))}).on("mouseout",function(t){d3.select(this).classed("active")||(d3.select(this).select("path").attr("fill","#fff"),d3.select(this).select("textPath").attr("fill","#000"))});function r(e){var t=l[n=e].content;d3.selectAll(".dbcontent").classed("active",!1),d3.select(".dbcontent--"+t).classed("active",!0),c.classed("active",!1),c.each(function(t){t.index===e&&d3.select(this).classed("active",!0)}),s()}function s(){c.selectAll("path").attr("fill",function(){return d3.select(this.parentNode).classed("active")?"#b71c1c":"#fff"}),c.selectAll("textPath").attr("fill",function(){return d3.select(this.parentNode.parentNode).classed("active")?"#fff":"#000"})}s(),c.append("path").attr("d",t).attr("fill",function(t,e){return 0===e?"#b71c1c":"#fff"}),c.each(function(t,e){var n=d3.select(this),a=(i-80+i-5)/2,a=(t.startAngle,t.endAngle,Math.PI,d3.svg.arc().innerRadius(a).outerRadius(a).startAngle(t.startAngle).endAngle(t.endAngle));n.append("path").attr("id","textPath-"+e).attr("d",a).style("fill","none").style("stroke","none");n.append("text").style("pointer-events","none").append("textPath").attr("xlink:href","#textPath-"+e).style("text-anchor","middle").attr("startOffset","25%").attr("dy","-0.5em").attr("fill",function(){return d3.select(this.parentNode.parentNode).classed("active")?"#fff":"#000"}).attr("font-size","10px").attr("font-weight","700").style("text-transform","uppercase").text(l[e].label)}),a.append("circle").attr("cx",0).attr("cy",0).attr("r",85).attr("fill","#b71c1c"),a.append("text").attr("dy","0.35em").style("text-anchor","middle").attr("class","inner-circle-text").attr("fill","#fff").attr("font-size","40px").attr("font-weight","bold").attr("letter-spacing","2px").text("VISION"),document.getElementById("prevBtn").addEventListener("click",function(){r(n=(n-1+l.length)%l.length)}),document.getElementById("nextBtn").addEventListener("click",function(){r(n=(n+1)%l.length)}),window.activateDonutArc=r}lenis.on("scroll",ScrollTrigger.update),gsap.ticker.add(t=>{lenis.raf(1e3*t)}),gsap.ticker.lagSmoothing(0);let init=()=>{gsap.registerPlugin(ScrollTrigger),donut()},isLinkClicked=(preloadImages("img").then(()=>{init()}),!1);$("a").on("click",function(t){!this.href||this.href.match(/^#/)||this.href.match(/^javascript:/)||(isLinkClicked=!0,console.log("1"))}),$(window).on("beforeunload",function(){isLinkClicked||$(window).scrollTop(0),isLinkClicked=!1});